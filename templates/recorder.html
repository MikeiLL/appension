<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">	
	<head>	  <meta charset="utf-8">
	
	<title>{{ page_title }}</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  

  <meta name="viewport" content="width=device-width, initial-scale=1">		
  <link rel="shortcut icon" type="image/png" href="/static/img/favicon.png" />

  <link rel="image_src" type="image/png" href="/static/img/icon.png" />

  <link href='http://fonts.googleapis.com/css?family=Signika:300' rel='stylesheet' type='text/css'>

  <link href='{{ compiled('style.scss') }}' rel='stylesheet' type='text/css' />

  <link href='{{ compiled('style-extra.scss') }}' rel='stylesheet' type='text/css' />
  
  <link href='{{ compiled(
  	'bar-ui.css',
	'sprites.css',
	'flashblock.css',
	'360player.css',
	'360player-visualization.css'
  ) }}' rel='stylesheet' type='text/css' />

  <link href='{{ compiled('style-responsive-players.scss') }}' rel='stylesheet' type='text/css' />
 
</head>
<body>
<div id="username" style="display:none">{{ user_name }}</div>
<header id="header" role="banner">
{% block user %}		
	<div class="user">				
		<p>Hello {{ user_name }}!</p>		
	</div>		
{% end %}		
{% if notice %}
	<h2> {{ notice }} </h2>
{% end %}
	<a href="/" style="display:block;">		
	<div id="title-admin">				
	</div></a>	
</header>	
<br style="clear:both"/>  
<!--Pattern HTML-->	
<div class="secondary">
	 <section id="pattern" class="pattern">  	
		<ul class="grid">
			<li class="wide">		
				<div class="secondary-two">	
				
				<div id="info"></div>
				  <img src="static/img/studio-title.png" border="0" width="266" height="195" alt=""><br/>
				  <div id="recorder_content">
				  
					<div id="intro">
						<h2>Welcome to The Studio</h2>
						I'm your engineer, Glitchy.
						<br/><br/>
						<div id="info"></div>

						<p>Due to the magic of modern technology we can now record you right here in your browser. Glitch Studio does have some limitations at the moment, though. Here's how it works.</p>
						<ul id="submit-points">
						<li>The browser will ask you if the application can "borrow" one of your computer microphones.</li>
						<li>There is a single "backing" track to sing along with. You'll hear it when you press record.</li>
						<li>It only keeps the section from the first downbeat following the count-in until you press stop.</li>
						<li>If you record without headphones, the "backing" track will be included in your "overdub" track, which will sound a bit ah... interesting.</li>
						<li>When listening back to your "overdub", prior to uploading and combining with "backing" track, there will be a few seconds of silence (or other "room noise") which is just what was happening during the click and count-in. 
						This time segment will not be included in the final track.</li>
						</ul>
						<div class="errors">(This will probably only work in Chrome version 3.2+ and recent versions of Firefox)</div><br>
						
						
						<div id="record_controls">
						  <button  class="btn btn-default" onclick="startRecording(this);">Record</button>
						  <button   class="btn btn-default"  onclick="stopRecording(this);" disabled>Stop</button>
						</div>

					</div>

						
					<div id="overdub_player" style="display:none">
					<h2>The Recording</h2>
						<p>This is what you just recorded. Remember, ignore the silence (or other noise) which is just what was happening during the click and count-in.</p>
						<ul id="recordingslist"></ul>
						<a href='#' id="upload" class="btn btn-default">Upload</a> |
						<a href='#' id="reset" class="btn btn-default">Reset</a>
					</div>


					<h2>Log</h2>
					<pre id="log"></pre>
				</div> <!-- End recorder-content -->
				
				<div id="audition_player" style="display:none;margin-top:1em">
					<p id="check_out">Check out the combined track:</p>
					<ul id="demo_player"></ul>
					<ul id="demo_player_controls"></ul>
				</div>
				
				<div id="submission_form" style="display:none">
					<p></p>
					<img width="212" border="0" height="38" alt="" src="static/img/submit-title.png">
					<p></p>
					<form enctype="multipart/form-data" action="/submit" method="post" id="submit_track">

					<table class="secondary">
					<tr><td>Artist Name: </td><td>{{ form.artist }} (used if missing from mp3 data)</td></tr>
					<tr><td>(For proper names like Marvin Gaye and Janice Joplin, please enter as: Last, First<br/>
					or even Costello, Elvis and the Attractions)</td></tr>
					<tr><td>Track Title: </td><td>{{ form.track_title }} (used if missing from mp3 data)</td></tr>
						{% if form.artist.errors %}
							<tr><td colspan=2> 
						<ul class="errors">{% for error in form.artist.errors %}<li class="error_notice">{{ error }}</li>{% end %}</ul>
							</td></tr>
					    {% end %}
					<tr><td colspan="2">Story behind the track:<br/> {{ form.story(rows=10,cols=60) }}</td></tr>
					<tr><td colspan="2">Lyrics: (in couplet form if possible - two lines, space and so on)<br/>{{ form.lyrics(rows=10,cols=60,placeholder="Sometimes you can fix...                               Elaborate on bla bla bla...") }}</textarea></td></tr>
					<tr><td colspan="2">Comments: <br/>{{ form.comments(rows=10,cols=60)}}</td></tr>
					<input name="track_source" type="hidden" value="glitch_studio" />

					<tr><td colspan="2" align="right"><input type="submit" value="submit track" /></td></tr>
					</table>
					</form>
				</div><!-- End submission form -->					  
			  </div><!-- End secondary two -->		

				<div style="clear:both;"></div>	
				
		
			</li>			
			{% block right-nav %}			
			<li>				
				<nav role="navigation">					
					<div style="text-align: center"><ul>
						<li><a href="/create_account"><img src="static/img/sign-up.png" border="0" width="78" height="23" alt=""></a></li>
						<li><a href="/login"><img src="static/img/login-link.png" border="0" width="62" height="25" alt=""></a></li>
						<li><a href="/logout"><img src="static/img/logout-link.png" border="0" width="47" height="39" alt=""></a></li>
						<li><a href="/choice_chunks"><img src="static/img/segment-selection-link.png" border="0" width="82" height="38" alt=""></a></li>
						<li><a href="/submit"><img src="static/img/submit-link.png" border="0" width="137" height="26" alt=""></a></li>
						<li><a href="/oracle"><img src="static/img/magic-ball-link.png" border="0" width="114" height="96" alt=""></a></li>
						<li><a href="/credits"><img src="static/img/credits-link.png" border="0" width="85" height="21" alt=""></a></li>
					</ul></div>				
				</nav>			
			</li>					
		</ul>	
	</section>		
	{% end %}	
</div>	
<div id="loading">
	<div id="loadingcontent">
		<p id="loadingspinner">
			<br/>
			I'm uploading your recording to the server now...<br/>
			This might take a few minutes 'cause we have to then analyze the audio using Echonest's API <br/>
			and it's Remix library and layer the two tracks together.
		</p>
	</div>
</div>	
<audio id='BackgroundTrack' src='/instrumentals/dgacousticlikMP3.mp3'/>


   <script type="text/javascript" src='https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js'></script>		
	<script type="text/javascript" src='{{ compiled('spin.min.js',		  
													'recorder.js') }}'>
	</script>	
	<script type="text/javascript" src='{{ compiled('remix.js') }}'>	
	<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

	<div class="container">			
		<footer role="contentinfo">
			<div>				
				<!-- Amended February 28 -->
				<nav id="menu">
					<ul class="footer_menu">
					<li class="footerlist"><a href="/">Home</a> </li>
					<li class="footerlist"><font size="-1">&nbsp;&copy; 2014 Future Fossil</font></li>
					<li class="footerlist"><a href="mailto:beezwax@aol.com">Contact</a>	</li>
					<li class="footerlist"><a href="http://chrisbutler1.bandcamp.com" target="_newbrowser">Bandcamp</a>	</li>
					<li class="footerlist"><a href="http://www.futurefossilmusic.com/" title="Home for all things Chris Butler">Future Fossil Music</a></li>
					
					</ul>
				</nav>			
			</div>		
		</footer>	
	</div>				
		
	
	<script type="text/javascript" >
	jQuery.noConflict();
	jQuery( document ).ready(function( $ ) {				
		$(".title").click(function() {
			window.location = $(this).find("a").attr("href"); 		  
			return false;		
			});	
		});	
	</script>	
	
	<script type="text/javascript">
				jQuery.noConflict();
				jQuery( document ).ready(function( $ ) {
					$(function () {
						$("#upload").click(function () {
							$("#loading").fadeIn();
							var opts = {
								lines: 12, // The number of lines to draw
								length:7, // The length of each line
								width: 4, // The line thickness
								radius: 10, // The radius of the inner circle
								color: '#000', // #rgb or #rrggbb
								speed: 1, // Rounds per second
								trail: 60, // Afterglow percentage
								shadow: false, // Whether to render a shadow
								hwaccel: false // Whether to use hardware acceleration
							};
							var target = document.getElementById('loading');
							var spinner = new Spinner(opts).spin(target);
						});
					});
				});	
	</script>	
		<script type="text/javascript" src='{{ compiled('socket.io.js') }}'></script>
		
		  <script>
			  function logHTML(e, data) {
				log.innerHTML += "\n" + e + " " + (data || '');
			  }


			  var audioContext;
			  var audioRecorder;


			  var _realAudioInput;
  
			  function handlerStartUserMedia(stream) {

				console.log('handlerStartUserMedia');
				console.log('sampleRate:'+ audioContext.sampleRate);

				// MEDIA STREAM SOURCE -> ZERO GAIN >
				_realAudioInput = audioContext.createMediaStreamSource(stream);

				audioRecorder = new Recorder(_realAudioInput);


			  }
  

			  function handlerErrorUserMedia(e) {
				  logHTML('No live audio input: ' + e);
			  }

			  function startRecording(button) {

				if(!audioRecorder)
				  return;
	
				var thissound=document.getElementById('BackgroundTrack');
					thissound.load();
					thissound.play();
 
				audioRecorder && audioRecorder.record();

				//GUI
				button.disabled = true;
				button.nextElementSibling.disabled = false;

				logHTML('Recording...');


			  }

			  function stopRecording(button) {

				if(!audioRecorder)
				  return;

					var thissound=document.getElementById('BackgroundTrack');
					thissound.pause();
					thissound.currentTime = 0;
	
				audioRecorder && audioRecorder.stop();

				//GUI
				button.disabled = true;
				button.previousElementSibling.disabled = false;

				logHTML('Stopped recording.');
 

			  }

			  window.onload = function init() {

					var $ = jQuery
					$.noConflict()
					console.log(1111)
					console.log($)
					var contextFunction = window.webkitAudioContext || window.AudioContext;
					if (contextFunction === undefined) {
						$("#info").text("Sorry, this app needs advanced web audio. Your browser doesn't"
							+ " support it. Try the latest version of Chrome");
					}
		
				  // webkit shim.
				  window.AudioContext = window.AudioContext || window.webkitAudioContext || window.mozAudioContext;

				  navigator.getUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);

				  window.URL = window.URL || window.webkitURL;
	  
				  audioContext = new AudioContext;

				  logHTML('Audio context set up.');
				  logHTML('navigator.getUserMedia ' + (navigator.getUserMedia ? 'available.' : 'not present!'));

				//} catch (e) {

				//  alert('No web audio support in this browser!');

				//}

	
				navigator.getUserMedia({vide:false, audio: true}, handlerStartUserMedia, handlerErrorUserMedia);

			  };

		  </script>
	</body>
</html>