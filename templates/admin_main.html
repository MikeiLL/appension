<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
   
<html lang="en">
	{% block head %}
	<head>
	  <meta charset="utf-8">
		<title>Infinite Glitch Admin</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="shortcut icon" type="image/png" href="/static/img/favicon.png" />
        <link rel="image_src" type="image/png" href="/static/img/icon.png" />
        <link href='http://fonts.googleapis.com/css?family=Signika:300' rel='stylesheet' type='text/css'>
        <link href='{{ compiled('style.scss') }}' rel='stylesheet' type='text/css' />
        <link href='{{ compiled('style-admin.scss') }}' rel='stylesheet' type='text/css' />
        <link href='{{ compiled(
          'sprites.css',
          'flashblock.css',
          '360player.css'
        ) }}' rel='stylesheet' type='text/css' />

	</head>
	{% end %}
<body>
<div id="pagewrap">
    	<div id="header">
		
		{% block user %}
		<div class="user">
				<p>Hello {{ user_name }}!</p>
		</div>
		{% end %}
		<center>
		<a href="/gmin" style="display:block;">
		<div id="title-admin">
		
		</div></a>
		</center>
	</div>
	<br style="clear:both">
	<div id="central">
		{% block content %}<p>totally empty page</p>{% end %}
	</div>	
	<br style="clear:both"/>
	<div class="footer">
		
		{% block footer %}	
			<a href="/">Front End View</a> &copy; 2015 Future Fossil 
			<a href="/submitters">Manage Submitter Info</a>
				
			<script type="text/javascript"
			  src='https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js'></script>
			<script type="text/javascript" src='{{ compiled(
			  'spin.min.js',
			  'soundmanager2-nodebug-jsmin.js',
			  'berniecode-animator.js',
			  '360player-admin.js'
			  ) }}'></script>
			<script type="text/javascript" src='{{ compiled('socket.io.js') }}'></script>
			<script type="text/javascript" src='{{ compiled('sm-configs.js') }}'></script>
			<script type="text/javascript" src='{{ compiled('raf.coffee', 'front.coffee') }}'></script>
			<script type="text/javascript">
				$('.confirmation').on('click', function () {
					return confirm('Are you sure?');
				});
			</script>
				<script type="text/javascript">
				jQuery.noConflict();
				jQuery( document ).ready(function( $ ) {
					$('form').on('submit', function(e) {
						e.preventDefault();

						// cache the current form so you make sure to only have data from this one
						var form = this,
						    $form = $(form);
						    
						$.ajax({
						    url: form.action,
						    type: form.method,
						    data: $form.serialize(),
						    audition_file: 'http://infiniteglitch.net/transition_audio/transition.mp3',
						    success: function(data, audition_file) {
							if (fileModified(audition_file) == 'true')
							{
							    $form.attr('action', '/audition').off('submit').submit();
							}
							else
							{	
							    my_spinner();
							    setTimeout(function(){
							    	return fileModified
							    	}, 1000, audition_file);
							}
						    },
						    error: function() {
							alert('There has been an error, please alert us immediately');
						    }
						});
					});

					var my_spinner = function () {
							$("#loading").fadeIn();
							var opts = {
								lines: 12, // The number of lines to draw
								length: 7, // The length of each line
								width: 4, // The line thickness
								radius: 10, // The radius of the inner circle
								color: '#000', // #rgb or #rrggbb
								speed: 1, // Rounds per second
								trail: 60, // Afterglow percentage
								shadow: false, // Whether to render a shadow
								hwaccel: false // Whether to use hardware acceleration
							};
							var target = document.getElementById('loading');
							var spinner = new Spinner(opts).spin(target);
						}
					
					function fileModified(url){
						var now = $.now()
						xhr.open('HEAD', url, true); // use HEAD - we only need the headers
						xhr.onreadystatechange = function() {
						    if (xhr.readyState === 4 && xhr.status === 200) {
						      var mtime = new Date(xhr.getResponseHeader('Last-Modified'));
						      if (mtime.toString() === 'Invalid Date') {
							return false;
						      } else {
							return now <= mtime;
						      }
						    }
						  }
						}
					});
				</script>	
		{% end %}
	</div>

</body>
</html>